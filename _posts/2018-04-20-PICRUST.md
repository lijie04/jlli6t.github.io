---
layout: post
title: Notes of PICRUST
author: Jie Li
categories: [bioinformatics tools]
tags: [annotation, prokaryotic, amplicon, pathway]
math: false
---

## Introduction
picrust 只能基于greengenes database进行预测，并且只有 13_5和 12_8两个版本。  
picrust是基于已经计算好的数据库进行预测，数据库[下载地址](http://picrust.github.io/picrust/picrust_precalculated_files.html)。  
下载的数据库需要放到Python-2.7.12/lib/python2.7/site-packages/PICRUSt-1.1.3-py2.7.egg/picrust/data/目录下；因为picrust软件默认是访问这个目录来找数据库

## Installation
安装picrust, 这个中间没有遇到麻烦；注意picrsut是基于python2.7版本(用的2.7.12)， 其他版本的python会报错例如python3.5.2

## Usage tips
因为picrust是读入biom文件 所以先要生成biom 格式的文件，其中biom需要包含的信息有每个样品注释上的物种信息及对应的丰度，生成biom的格式方法有两种：

### way 1
通过利用qiime1的命令先挑选otu比对的ref, 这里相当于重新比对分类一次，默认方法是uclust(其他还有usearch_ref， sortmerna), 所以挑出来的otu 比OTU_final.fasta里的序列要少, 整体预测的通路的矩阵里的值会小一些，通路数量上可能也小一些. 这里好像不支持rdp的结果，因为rdp基于贝叶斯的概率方法，最后没有给出具体比对的哪个id, 而是只给出一个分类taxonomy信息。

**step 1**  
首先用qiime1里的pick_closed_reference_otus.py 命令挑选ref：(可以使用97，也可以使用90，99或者其他的)
{% highlight bash %}
echo "pick_otus:enable_rev_strand_match True">>otu_picking_params_97.txt
echo "pick_otus:similarity 0.97">>otu_picking_params_97.txt
pick_closed_reference_otus.py -i OTU_final.fasta -o $PWD/ucrC972/ -p $PWD/otu_picking_params_97.txt -r ./gg_13_5_otus/rep_set/97_otus.fasta -t ./gg_13_5_otus/taxonomy/97_otu_taxonomy.txt -a -O 8
{% endhighlight %}

**step 2**  
使用命令`biom convert -i ucrC972/otu_table.biom -o ucrC972/otu_table.biom.tsv --to-tsv`
tsv文件如下图：主要是得到每个otu比对上的ref, 然后形成一个0 1矩阵
![](/assets/_imgs/)
